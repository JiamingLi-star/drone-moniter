# 服务器启动指南

## 问题诊断

如果遇到 `Unsupported config option` 错误，可能是以下原因：

1. **docker-compose 版本过旧**（v1.x）
2. **使用了新的 docker compose 命令**（没有连字符）

## 解决方案

### 方法1: 检查 docker-compose 版本

```bash
# 检查版本
docker-compose --version
# 或
docker compose version
```

### 方法2: 根据版本选择启动命令

#### 如果是 docker-compose v1.x（旧版本）

```bash
cd autonomous-vehicle
docker-compose up -d --build
```

如果还是报错，可能需要升级 docker-compose：

```bash
# 下载最新版本
sudo curl -L "https://github.com/docker/compose/releases/download/v2.24.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
docker-compose --version
```

#### 如果是 docker compose v2（新版本，没有连字符）

```bash
cd autonomous-vehicle
docker compose up -d --build
```

### 方法3: 直接使用 docker 命令启动（如果 docker-compose 有问题）

```bash
cd autonomous-vehicle

# 1. 确保 my-network 网络存在
docker network inspect my-network || docker network create my-network

# 2. 构建镜像
docker build -t autonomous-vehicle-service .

# 3. 启动容器
docker run -d \
  --name vehicle-service \
  --network my-network \
  -p 8060:8060 \
  -v $(pwd)/log:/app/log \
  -e TZ=Asia/Shanghai \
  --restart always \
  autonomous-vehicle-service
```

### 方法4: 使用项目根目录的 deploy.sh（推荐）

如果其他服务都正常，可以在项目根目录使用统一的启动脚本：

```bash
cd /path/to/drone-moniter

# 先确保其他服务已启动（因为需要 my-network 网络）
# 然后手动启动 autonomous-vehicle
cd autonomous-vehicle
docker-compose up -d --build
# 或
docker compose up -d --build
```

## 验证服务启动

```bash
# 检查容器状态
docker ps | grep vehicle

# 检查服务是否响应
curl http://localhost:8060/vehicle/online_count

# 查看日志
docker logs vehicle-service
```

## 常见错误处理

### 错误1: 网络不存在

```bash
# 创建网络
docker network create my-network
```

### 错误2: 端口被占用

```bash
# 检查端口占用
sudo netstat -tulpn | grep 8060

# 如果被占用，可以修改 docker-compose.yml 中的端口映射
# 例如改为 8061:8060
```

### 错误3: 权限问题

```bash
# 确保当前用户在 docker 组中
sudo usermod -aG docker $USER
# 需要重新登录才能生效

# 或者使用 sudo
sudo docker-compose up -d --build
```

## 查看日志排查问题

```bash
# 查看容器日志
docker logs vehicle-service

# 实时查看日志
docker logs -f vehicle-service

# 查看最近50行日志
docker logs vehicle-service --tail 50
```

## 停止服务

```bash
cd autonomous-vehicle
docker-compose down
# 或
docker compose down
# 或
docker stop vehicle-service && docker rm vehicle-service
```
