"use strict";

var deepmerge = require("deepmerge");

function _create_class(Constructor, protoProps, staticProps) {
    return protoProps && function(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || !1, descriptor.configurable = !0, 
            "value" in descriptor && (descriptor.writable = !0), Object.defineProperty(target, descriptor.key, descriptor);
        }
    }(Constructor.prototype, protoProps), Constructor;
}

var I18n = function() {
    function I18n(translations, options) {
        this._translations = {}, this._locale = null == options ? void 0 : options.defaultLocale, 
        translations && (this._translations = translations, (null == options ? void 0 : options.defaultLocale) || (this._locale = Object.keys(translations)[0])), 
        this.options = options || {};
    }
    var _proto = I18n.prototype;
    return _proto.t = function(scope, variables) {
        var value, translation = this._translations[this._locale];
        if (!translation) return "function" == typeof this.options.customizeMissing ? this.options.customizeMissing(scope, variables) : '[missing "' + this._locale + '" locale]';
        if ("string" == typeof scope && scope.includes(".") && !(scope in translation)) {
            var _this__findChainValue = this._findChainValue(translation, scope), v = _this__findChainValue[0];
            if (_this__findChainValue[1]) value = v; else {
                if (void 0 === (null == variables ? void 0 : variables.defaultvalue)) return "function" == typeof this.options.customizeMissing ? this.options.customizeMissing(scope, variables) : '[missing "' + this._locale + "." + scope + '" translation]';
                value = variables.defaultvalue;
            }
        } else if (scope in translation) value = translation[scope]; else {
            if (void 0 === (null == variables ? void 0 : variables.defaultvalue)) return "function" == typeof this.options.customizeMissing ? this.options.customizeMissing(scope, variables) : '[missing "' + this._locale + "." + scope + '" translation]';
            value = variables.defaultvalue;
        }
        return "string" == typeof value && variables && /\{\{\s*(\w+)\s*\}\}/.test(value) ? value.replace(/\{\{\s*(\w+)\s*\}\}/g, function(_, varName) {
            return String(variables[varName]) || "";
        }) : value;
    }, _proto.appendTranslations = function(translations) {
        this._translations = deepmerge(this._translations, translations, {
            clone: !1
        }), this._locale || (this._locale = Object.keys(this._translations)[0]), this._onChange();
    }, _proto.switchLocale = function(locale) {
        locale in this._translations && (this._locale = locale, this._onChange());
    }, _proto.switchTranslation = function(locale) {
        this.switchLocale(locale);
    }, _proto.getCurrentLocale = function() {
        return this._locale;
    }, _proto.getCurrentTranslation = function() {
        return this._translations[this._locale];
    }, _proto.getVersion = function() {
        return "2.0.0";
    }, _proto._onChange = function() {
        return null == this.options.onChange ? void 0 : this.options.onChange.call(this.options, this);
    }, _proto._findChainValue = function(obj, path) {
        for (var paths = path.split("."), translation = obj, i = 0; i < paths.length; i++) {
            if (!(paths[i] in translation)) return [ void 0, !1 ];
            if (translation = translation[paths[i]], i + 1 === paths.length) return [ translation[paths[i]], !0 ];
        }
        return [ void 0, !1 ];
    }, _create_class(I18n, [ {
        key: "locale",
        get: function() {
            return this._locale;
        }
    }, {
        key: "translations",
        get: function() {
            return this._translations;
        }
    } ]), I18n;
}();

I18n.VERSION = "2.0.0", module.exports = I18n;
